{% extends "record/specimen.html" %}

{% block heading %}

     <h1 class="page-heading">GBIF interpreted record</h1>

{% endblock %}

{% block record_data %}

    <table id="record-view">

          <col width="300">
          <col>

        {# Identification #}

        {% set classification = h.gbif_get_classification(gbif_record) %}

        {% set errors = h.dqi_parse_errors(gbif_record['gbifIssue']) %}

        {% if classification or gbif_record['gbifSpeciesKey'] or gbif_record['gbifIdentifiedBy'] %}

            <thead>
                <tr>
                    <th>Identification details</th>
                    <th><small>According to <a href="http://www.gbif.org/dataset/d7dddbf4-2cf0-4f39-9b2a-bb099caae36c" target="_blank" rel="nofollow">GBIF Backbone Taxonomy</a></small></th>
                </tr>
            </thead>
            <tbody>

                {% if gbif_record['gbifSpeciesKey'] %}

                    <tr>
                        <td><strong>Identified as species</strong></td>
                        <td>
                            <a href="http://www.gbif.org/species/{{ gbif_record['gbifSpeciesKey'] }}" target="_blank" rel="nofollow">{{ gbif_record['gbifScientificName'] }}</a>
                        </td>
                    </tr>

                {% endif %}

                {% if classification %}

                    <tr>
                        <td><strong>Taxonomic classification</strong></td>
                        <td>
                            {{ classification }}
                        </td>
                    </tr>

                {% endif %}

                {% if gbif_record['gbifIdentifiedBy'] %}

                    <tr>
                        <td><strong>Identified</strong></td>
                        <td>
                            {{ gbif_record['gbifIdentifiedBy'] }}
                        </td>
                    </tr>

                {% endif %}

            </tbody>

        {% endif %}

        {# Occurrence details #}

        {% if gbif_record['gbifRecordedBy'] or gbif_record['gbifEventDate'] or gbif_record['gbifRecordNumber'] %}

            <thead>
                <tr>
                    <th colspan="2">Occurrence details</th>
                </tr>
            </thead>
            <tbody>

                {% if gbif_record['gbifRecordedBy'] %}

                    <tr>
                        <td><strong>Recorded by</strong></td>
                        <td>{{ gbif_record['gbifRecordedBy'] }}</td>
                    </tr>

                {% endif %}

                {% if gbif_record['gbifEventDate'] %}

                    <tr>
                        <td><strong>Date recorded</strong></td>
                        <td>{{ gbif_record['gbifEventDate'] }}</td>
                    </tr>

                {% endif %}


                {% if gbif_record['gbifRecordNumber'] %}

                    <tr>
                        <td><strong>Record number</strong></td>
                        <td>{{ gbif_record['gbifRecordNumber'] }}</td>
                    </tr>

                {% endif %}

            </tbody>

        {% endif %}

        {# Location #}

        {% set geography = h.gbif_get_geography(gbif_record) %}

        {% if geography or gbif_record['gbifHabitat'] or gbif_record['gbifCountryCode'] or gbif_record['gbifIslandGroup'] or (gbif_record['gbifDecimalLongitude'] and gbif_record['gbifDecimalLatitude']) %}

            <thead>
                <tr>
                    <th colspan="2">Location</th>
                </tr>
            </thead>
            <tbody>

                {% if gbif_record['gbifCountryCode'] %}

                    <tr>
                        <td><strong>Country</strong></td>
                        <td><a href="http://www.gbif.org/country/{{ gbif_record['gbifCountryCode'] }}" target="_blank" rel="nofollow">{{ gbif_record['country'] or gbif_record['gbifCountryCode'] }}</a></td>
                    </tr>

                {% endif %}

                {% if gbif_record['gbifDecimalLongitude'] and gbif_record['gbifDecimalLatitude'] %}

                    <tr>
                        <td><strong>Coordinates</strong></td>
                        <td><a href="http://www.gbif.org/gbif_record/{{ gbif_record['gbifID'] }}#map" target="_blank" rel="nofollow">{{ gbif_record['gbifDecimalLongitude'] }}, {{ gbif_record['gbifDecimalLatitude'] }}</a></td>
                    </tr>

                {% endif %}

                {% if geography %}

                    <tr>
                        <td><strong>Geographic classification</strong></td>
                        <td>
                            {{ geography }}
                        </td>
                    </tr>

                {% endif %}

                {% if gbif_record['gbifIslandGroup'] %}

                    <tr>
                        <td><strong>Islands</strong></td>
                        <td>{{ gbif_record['gbifIslandGroup'] }}</td>
                    </tr>

                {% endif %}

                {% if gbif_record['gbifHabitat'] %}

                    <tr>
                        <td><strong>Habitat</strong></td>
                        <td>{{ gbif_record['gbifHabitat'] }}</td>
                    </tr>

                {% endif %}

            </tbody>

        {% endif %}

        {% if errors %}

            <thead>
                <tr>
                    <th colspan="2">Data Quality Issues</th>
                </tr>
            </thead>
            <tbody>

                {% for error in errors %}

                    <tr>
                        <td><strong>{{ error['title'] }}</strong></td>
                        <td>{{ error['description'] }}</td>
                    </tr>

                {% endfor %}

            </tbody>

        {% endif %}

        {# Publication details #}

        <thead>
            <tr>
                <th colspan="2">GBIF Publication details</th>
            </tr>
        </thead>
        <tbody>

            <tr>
                <td><strong>Last interpreted</strong></td>
                <td>{{ h.gbif_render_datetime(gbif_record['gbifLastInterpreted']) }}</td>
            </tr>

            <tr>
                <td><strong>Last parsed</strong></td>
                <td>{{ h.gbif_render_datetime(gbif_record['gbifLastParsed']) }}</td>
            </tr>

            <tr>
                <td><strong>Occurrence</strong></td>
                <td><a href="http://www.gbif.org/occurrence/{{ gbif_record['gbifID'] }}" target="_blank" rel="nofollow">{{ gbif_record['gbifID'] }}</a></td>
            </tr>

            <tr>
                <td><strong>Dataset</strong></td>
                <td><a href="http://www.gbif.org/dataset/{{ dataset_key }}" target="_blank" rel="nofollow">Dataset</a></td>
            </tr>

            <tr>
                <td><strong>Publisher</strong></td>
                <td><a href="http://www.gbif.org/publisher/{{ organisation_key }}" target="_blank" rel="nofollow">Natural History Museum</a></td>
            </tr>

        </tbody>

    </table>

    {% resource 'ckanext-gbif/record' %}

{% endblock %}